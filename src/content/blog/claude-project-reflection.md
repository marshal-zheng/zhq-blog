---
author: ZHQ
pubDatetime: 2025-07-15T12:45:00+08:00
title: 'Claude Code 指令优化'
featured: false
draft: false
tags:
  - 'prompt'
description: '通过自定义指令优化Claude.md'
---
在使用 Claude Code 的过程中，经常因为难以追踪指令更新和收集使用反馈而感到困扰。为此，我在 CLAUDE.md 中引入了一条「项目反思」命令——只需在项目根目录执行

该命令会自动扫描当前指令集，并结合我的实际项目场景，生成一份可读性强、直击痛点的优化建议清单。这样，我无需再手动梳理版本差异，也不用担心遗漏关键用例；每次迭代，一键触发即可让文档与代码实现保持同步，让我对最新流程了如指掌，显著提升了开发效率与交付质量。

```markdown
# Claude Code 指令优化指南

作为一名精通提示工程的专家，你的任务是分析并优化 Claude Code 的指令。请按照以下步骤操作：

## 1. 分析阶段

- **回顾上下文**：首先，审查当前对话历史。
- **检查指令与配置**：仔细阅读现有 Claude 指令、命令和配置文件，包括：
  - `/CLAUDE.md`
  - `/.claude/commands/*`
  - `**/CLAUDE.md`
  - `.claude/settings.json`
  - `.claude/settings.local.json`
- **识别改进点**：
  - Claude 回复不一致的地方
  - 对用户请求理解有误的情况
  - Claude 可提供更详细或更准确信息的场景
  - 增强 Claude 处理特定查询或任务能力的机会
  - 新增命令或优化命令名称、功能、回复内容
  - 本地已批准但未加入配置的权限和 MCP，尤其是新增工具或命令所需权限

## 2. 交互阶段

- 向用户展示你的分析结果和改进建议。每条建议需包含：
  1. 当前存在的问题说明
  2. 具体的修改或新增建议
  3. 该建议如何提升 Claude 的表现
- 等待用户对每条建议的反馈。若用户同意，进入实现阶段；若不同意，进一步完善建议或继续下一个。

## 3. 实现阶段

- 对于每条获批的改进：
  1. 明确指出要修改的指令部分
  2. 给出新的或修改后的文本
  3. 解释该修改如何解决分析阶段发现的问题

## 4. 输出格式

最终输出请遵循以下结构：

```markdown
<analysis>
[列出发现的问题及潜在改进点]
</analysis>

<improvements>
[每条获批改进包括：
1. 被修改的部分
2. 新的或修改后的指令文本
3. 该改进如何解决问题的说明]
</improvements>

<final_instructions>
[整合所有获批改进后的 Claude 指令完整文本]
</final_instructions>
> 目标：提升 Claude 的表现与一致性，同时保持 AI 助手的核心功能和定位。分析要细致，说明要清晰，实施要精准。
```

---

在使用 /project:reflection 命令时，其背后其实依赖了以下五个工程化的核心原理：

1. **文档结构化解析**  
  工具会先用 [CommonMark 标准](https://commonmark.org/) 将 `CLAUDE.md` 转成抽象语法树（AST），把每条指令、示例和参数说明都拆解成可编程的数据结构，以便后续统一处理和比对

2. **项目上下文扫描**  
   借助对代码仓库、Git 提交记录和 Issue 评论的自动检索，它能快速定位每条命令在真实项目中的调用点、常见报错或讨论，形成“文档条目 ↔ 实际使用”之间的映射关系。

3. **文档-场景关联**  
   通过向量化检索技术（embeddings），系统会在文档片段与项目代码／日志中找到最相关的内容，并将它们打包到一起，确保后续分析基于最新、最贴切的上下文。

4. **分步逻辑推理**  
   在生成优化建议前，命令会先在内部“草稿区”列出多步推理流程，依次对比文档描述与实际场景差异，避免一次性输出时遗漏细节或出现逻辑跳跃。

5. **结构化建议输出**  
   最终，它会将改进要点按“示例补充”“说明精简”“参数校对”“歧义消除”等类别整理，用 Markdown 清单或预定义的 JSON Schema 输出，让你无需二次手工归类，直接拿来修改文档或提 PR。